import os
import pydicom

def extract_dicom_metadata(folder_path):
    """
    Extracts metadata from DICOM files within a specified folder.

    Iterates over all files in the given folder path, reads each file with a '.dcm' extension,
    and extracts relevant DICOM metadata. The metadata for each file is stored in a dictionary
    with the filename as the key.

    Args:
        folder_path (str): Path to the folder containing DICOM files.

    Returns:
        dict: A dictionary where each key is a DICOM filename and the value is another dictionary
        containing extracted metadata fields such as 'PatientName', 'PatientID', 'StudyDate',
        'StudyTime', 'Modality', 'SeriesDescription', 'Rows', 'Columns', and 'PixelSpacing'.
    """
    metadata_dict = {}
    for filename in os.listdir(folder_path):
        if filename.endswith(".dcm"):
            file_path = os.path.join(folder_path, filename)
            ds = pydicom.dcmread(file_path)
            metadata = {
                'PatientName': ds.PatientName,
                'PatientID': ds.PatientID,
                'StudyDate': ds.StudyDate,
                'StudyTime': ds.StudyTime,
                'Modality': ds.Modality,
                'SeriesDescription': ds.SeriesDescription,
                'Rows': ds.Rows,
                'Columns': ds.Columns,
                'PixelSpacing': ds.PixelSpacing
            }
            metadata_dict[filename] = metadata
    return metadata_dict

folder_path = '../test_for_anonymisation'
metadata_dict = extract_dicom_metadata(folder_path)
print(metadata_dict)